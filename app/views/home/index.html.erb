<% if user_signed_in? %>
<form method="get" action="home/create_room"> 
    <button type="submit">방만들기</button>
</form>
<button id = "button1">참여하기</button>
<a href="/users/sign_out">로그아웃</a>
<% else %>
<a href="/users/sign_in">로그인</a>
<a href="/users/sign_up">회원가입</a>
<% end %>

<script>
    var url = window.location.hostname+':'+window.location.port
    var dispatcher = new WebSocketRails(url+'/websocket');

    var test = {text: 'hello world'}
    dispatcher.trigger('game.connection', test);
    //get my message
    dispatcher.bind('game.connection_success', function(task) {
      $('body').append(task.message)
    });

    $('#button1').on('click', function(){
        var roomcode = prompt('방 번호를 입력하세요')
        dispatcher.trigger('game.room_connect', roomcode);
        dispatcher.bind('game.room_connect_status',function(task){
          if (task.status){
            window.location = '/home/join_room/'+roomcode
          }else {
            alert(task.message)
            dispatcher.unbind('game.room_connect_status')
          }
        })
    })
</script>
